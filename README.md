# EffectMidi

<p align="center"><img src="./resources/EffectMidi_1024.png" width="150px"/></p

<em><h5 align="center">ä½¿ç”¨ <a href="https://electron-vite.org/">electron-vite</a> æ„å»ºï¼Œé‡‡ç”¨<a href="https://www.typescriptlang.org/">Typescript</a> + <a href="https://react.dev/">React</a> å¼€å‘ï¼Œå¹¶ä¾èµ–<a href="https://www.arduino.cc/">Arduino</a>å¹³å°è¿è¡Œ</h5></em>

## è¯´æ˜

æœ¬é¡¹ç›®å—[Effect_Piano_light_controller](https://github.com/esun-z/Effect_Piano_light_controller)å¯å‘ï¼Œé€šè¿‡æ¡Œé¢ç«¯æ§åˆ¶ MIDI é”®ç›˜çš„å¤–ç½®ç¯å…‰æ•ˆæœï¼Œé€šè¿‡è¯»å– MIDI é”®ç›˜è¾“å…¥ï¼Œæ§åˆ¶ç¯å¸¦çš„æ•ˆæœã€‚

### ç‰¹æ€§

![ä¸»ç•Œé¢](./doc/main.jpg)

æ‰€æœ‰é…ç½®å‡ä¼šä¿å­˜åœ¨ç¨‹åºç›®å½•ä¸‹çš„ `effect-midi.db` æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œåœ¨ä¼ é€’æœ¬ç¨‹åºæ—¶ï¼Œå¯ä»¥å¸¦ä¸Šè¿™ä¸ªæ–‡ä»¶ä»¥ä¿ç•™é…ç½®ã€‚

![é…ç½®ç•Œé¢](./doc/effect.jpg)

æœ¬ç¨‹åºæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

+ **âœ¨ç•Œé¢å¤–è§‚è®¾ç½®**ï¼šï¼ˆæ§åˆ¶ç«¯ï¼‰èƒŒæ™¯å›¾ã€é¢œè‰²ä¸»é¢˜ã€èƒŒæ™¯åŠ¨ç”»ã€ç‚¹å‡»åŠ¨ç”»ã€éŸ³ç¬¦ç€‘å¸ƒ
+ **âš™ï¸è®¾å¤‡è¿æ¥**ï¼šæ”¯æŒé€‰æ‹©ç”Ÿæ•ˆçš„ MIDI è®¾å¤‡å’Œä¸²å£è®¾å¤‡ï¼ˆä¸²å£é€‰æ‹©åéœ€è¦æ‰‹åŠ¨å¯ç”¨ï¼‰
+ **ğŸŒˆæ•ˆæœè®¾ç½®**ï¼šæ”¯æŒè®¾ç½®ç¯å¸¦èƒŒæ™¯è‰²ã€å‰æ™¯è‰²ã€ç«¯ç‚¹ç¯é¢œè‰²ã€æ‰©æ•£å®½åº¦ã€å»¶è¿Ÿæ—¶é—´

æ§åˆ¶ç«¯é™¤åº•éƒ¨é”®ç›˜ç»„ä»¶å¤–ï¼Œå…¶ä»–ç»„ä»¶å‡å¯æŠ˜å ï¼ˆå·¦ä¸Šè§’æŠ˜å æŒ‰é’®ï¼‰ï¼ŒæŠ˜å åå¯ä»¥æ›´å¥½çš„å±•ç¤ºé”®ç›˜éŸ³ç¬¦ç€‘å¸ƒã€‚

[æ›´å¤šåŠŸèƒ½ä»‹ç»ã€é¡¹ç›®æ¦‚è§ˆ](https://mori.plus/archives/effect-midi-01)

## ä½¿ç”¨æ–¹æ³•

### ç¡¬ä»¶æ¸…å•

- **Arduino å¼€å‘æ¿**ï¼šæœ€ç®€ä½¿ç”¨å¯ä»¥é€‰æ‹© Arduino Uno R3ã€‚ï¼ˆå¦‚æœéœ€è¦è¿›è¡Œå¼€å‘ï¼Œæˆ–è€…è€ƒè™‘åç»­å¯èƒ½çš„åŠŸèƒ½å‡çº§ï¼Œæ¨èä½¿ç”¨æ›´é«˜æ€§èƒ½çš„å¼€å‘æ¿ï¼Œæ¯”å¦‚ Arduino Mega 2560ï¼‰
- **WS2812B ç¯å¸¦**ï¼šç¨‹åºå…¼å®¹çš„è§„æ ¼ä¸º144ç¯/mï¼ˆä¸€ä¸ªé”®å¯¹åº”ä¸¤ä¸ªç¯ï¼‰ï¼Œå…±éœ€è¦178ä¸ªç¯ç ï¼ˆ2ç«¯ç‚¹ç¯+88Ã—2ï¼‰ï¼Œé€šå¸¸éœ€è¦è´­ä¹°ä¸¤ç±³çš„ç¯å¸¦åå‰ªæ‰å¤šä½™çš„ç¯ç 
- **MIDI é”®ç›˜**ï¼š88é”® MIDI é”®ç›˜ï¼Œå¯ä»¥æ˜¯ç”µå­ç´ã€MIDI é”®ç›˜ç­‰ï¼ˆå°‘äº88é”®çš„é”®ç›˜ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œæ²¡æœ‰æµ‹è¯•ï¼‰
- **å¯¼çº¿**ï¼šæœ€ç®€æ–¹æ¡ˆéœ€è¦ 2 æ ¹å…¬å¯¹å…¬æœé‚¦çº¿ï¼Œ1 æ ¹å…¬å¯¹æ¯æœé‚¦çº¿
- **330Î© ç”µé˜»**

### è¿çº¿æ–¹æ¡ˆ

å‚è€ƒ[arduino æ§åˆ¶ ws2812b æ•™ç¨‹](https://howtomechatronics.com/tutorials/arduino/how-to-control-ws2812b-individually-addressable-leds-using-arduino/)

![å‚è€ƒè¿çº¿æ–¹æ¡ˆ](https://howtomechatronics.com/wp-content/uploads/2018/01/How-to-Connect-WS2812B-LEDs-and-Arduino-Circuit-Schematic-1024x410.png?ezimgfmt=ng:webp/ngcb2)

å› ä¸ºæœ¬é¡¹ç›®çš„æ–¹æ¡ˆä¸‹ï¼Œå¼€å‘æ¿ç›´è¿ç”µè„‘ï¼Œæ‰€ä»¥è¿çº¿æ–¹æ¡ˆä¸­çš„å¤–æ¥ç”µæºå¯ä»¥çœç•¥ã€‚

![UNO R3 æœ€ç®€è¿çº¿æ–¹æ¡ˆ](./doc/line_uno_r3.jpg)

### ç¨‹åºçƒ§å½•

1. ä¸‹è½½æœ¬é¡¹ç›®çš„ä»£ç 
2. ä½¿ç”¨ Arduino IDE æ‰“å¼€ `arduino/EffectMidi/EffectMidi.ino`ï¼Œæ³¨æ„ï¼Œé¡¹ç›®ä»£ç éå•æ–‡ä»¶ï¼Œå¦‚æœæ‹·è´åˆ°å…¶ä»–ç›®å½•ï¼Œéœ€è¦ä¿æŒç›®å½•ç»“æ„ï¼ˆ`EffectMidi` ç›®å½•ä¸‹æ–‡ä»¶å®Œæ•´ï¼‰
3. æ›´æ–°é©±åŠ¨ï¼šæ‰“å¼€è®¾å¤‡ç®¡ç†å™¨ï¼Œæ‰¾åˆ° `ç«¯å£ï¼ˆCOM å’Œ LPTï¼‰` ä¸‹çš„ `USB-SERIAL CH340`ï¼Œå³é”®æ›´æ–°é©±åŠ¨ï¼Œé€‰æ‹©æ‰‹åŠ¨æ›´æ–°ï¼Œé€‰æ‹© `arduino/drivers` ç›®å½•ä¸‹çš„é©±åŠ¨
4. é€‰æ‹©å¼€å‘æ¿ï¼š`å·¥å…·` -> `å¼€å‘æ¿` -> `Arduino Uno`
5. é€‰æ‹©ç«¯å£ï¼š`å·¥å…·` -> `ç«¯å£` -> é€‰æ‹© `COM` å¼€å¤´çš„ç«¯å£
6. å®‰è£…ä¾èµ–åº“ï¼š`å·¥å…·` -> `ç®¡ç†åº“` -> æœç´¢ `FastLED` -> å®‰è£…ï¼Œå¦‚æœéœ€è¦ OLED æ˜¾ç¤ºï¼ˆéœ€ä¿®æ”¹ä»£ç ï¼Œä»…æµ‹è¯•ä½¿ç”¨ï¼Œæ— å®é™…åŠŸèƒ½ï¼‰ï¼Œæœç´¢ `Adafruit SSD1306` å’Œ `Adafruit GFX Library` è¿›è¡Œå®‰è£…
7. ç¼–è¯‘å¹¶ä¸Šä¼ ï¼šç‚¹å‡»å·¦ä¸Šè§’çš„ `ä¸Šä¼ `
8. ç«¯ç‚¹ç¯ç¼“æ…¢é—ªçƒï¼Œè¡¨ç¤ºç¨‹åºæ­£å¸¸è¿è¡Œï¼Œç­‰å¾…æ§åˆ¶ç«¯è¿æ¥

### æ§åˆ¶ç«¯ç¨‹åº

è®¿é—®æœ¬é¡¹ç›®çš„ [Releases](https://github.com/ChiruMori/EffectMidi/releases) é¡µé¢ä¸‹è½½åˆé€‚çš„ç‰ˆæœ¬ï¼Œè§£å‹åè¿è¡Œ `EffectMidi.exe` æŒ‰ç…§æç¤ºä½¿ç”¨å³å¯ã€‚

## å·¥ä½œåŸç†

1. Windows æ§åˆ¶ç«¯è¯»å– MIDI è¾“å…¥è®¾å¤‡çš„ MIDI ä¿¡å·
2. Windows æ§åˆ¶ç«¯é€šè¿‡ USB ä¸²å£å‘é€æŒ‡å®šçš„ä¿¡å·åˆ° Arduino å¼€å‘æ¿
3. Arduino å¼€å‘æ¿æ¥å—æ§åˆ¶ä¿¡å·åæ§åˆ¶ LED çš„æ•ˆæœ

## å¼€å‘ç¯å¢ƒ

### ç¡¬ä»¶è®¾å¤‡

ç¡¬ä»¶è®¾å¤‡åŒä¸Šï¼Œä¸æ¨èä½¿ç”¨è¾ƒä½æ€§èƒ½çš„å¼€å‘æ¿

### PC æ§åˆ¶ç«¯

é¡¹ç›®ä½¿ç”¨ [electron-vite](https://electron-vite.org/config/) æ„å»ºï¼Œæ¨èä½¿ç”¨ [Visual Studio Code](https://code.visualstudio.com/) ç¼–è¾‘å™¨ï¼ˆå¹¶å»ºè®®å®‰è£… `Tailwind CSS IntelliSense`, `Prettier - Code formatter`, `EditorConfig for VS Code`, `stylus`ï¼‰ã€‚

å¼€å‘ç¯å¢ƒä¸‹ï¼Œå¯åŠ¨åå¯ä»¥é€šè¿‡ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚

- `pnpm install` å®‰è£…ä¾èµ–ï¼ŒæœŸé—´å¦‚æœå‡ºç°å¥‡æ€ªçš„æŠ¥é”™ï¼Œå¯ä»¥å°è¯• pnpm 8.x.x ç‰ˆæœ¬
- `pnpm dev` å¯åŠ¨å¼€å‘ç¯å¢ƒ
- `pnpm build:win` æ‰“åŒ… Windows ç‰ˆæœ¬
- `pnpm build:mac` æ‰“åŒ… macOS ç‰ˆæœ¬
- `pnpm build:linux` æ‰“åŒ… Linux ç‰ˆæœ¬

### Arduino å¼€å‘æ¿ç«¯

æ¨èä½¿ç”¨ [Arduino IDE](https://www.arduino.cc/en/software)ã€‚æš‚æœªå‘ç° VSCode ä¸Š Arduino çš„åˆé€‚æ’ä»¶ï¼Œä»éœ€ä¾èµ– Arduino IDE å®Œæˆå¼€å‘ï¼ˆè§£å†³ä¾èµ–ã€éªŒè¯ç¼–è¯‘ã€ä¸Šä¼ ï¼‰ã€‚

ä¾èµ–ä¸‹åˆ—åº“ï¼š

- [FastLED](https://fastled.io/) - å¿…é¡»ï¼Œç”¨äºæ§åˆ¶ç¯å¸¦

å¼€å‘ç¯å¢ƒä¸‹ï¼Œå¯ä»¥é€šè¿‡å¯ç”¨ `#define USE_OLED` æ¿€æ´»è°ƒè¯•ä¿¡æ¯å±•ç¤ºï¼Œä¹Ÿå¯ä»¥ä»æºç é‡Œå½»åº•åˆ é™¤æœ‰å…³ä»£ç æ¥é‡Šæ”¾ä¸€éƒ¨åˆ†æ€§èƒ½ï¼Œè¿æ¥æ–¹å¼ï¼š

+ `SDA` -> `SDA`
+ `SCL` -> `SCL`
+ `GND` -> `GND`
+ `VCC` -> `5V`

> æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨çš„å¼€å‘æ¿å†…å­˜è¾ƒå°ï¼ŒOLED å¯èƒ½ä¸å·¥ä½œã€‚

ä¾èµ–çš„åº“ï¼š

- [Adafruit_GFX](https://github.com/adafruit/Adafruit-GFX-Library)
- [Adafruit_SSD1306](https://github.com/adafruit/Adafruit_SSD1306)

